<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Weather App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Segoe UI', sans-serif;
      transition: background-image 1s ease-in-out;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      background-image: url('image.png');
      padding: 1rem;
    }
    .weather-box {
      background: #ffffffdd;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      max-width: 400px;
      width: 100%;
      margin: 1rem auto;
    }
    @media (max-width: 600px) {
      .weather-box {
        padding: 1rem;
        max-width: 98vw;
      }
      .weather-icon {
        width: 60px;
      }
    }
    #weatherResult {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }
    #weatherResult.show {
      opacity: 1;
      transform: translateY(0);
    }
    #cityInput {
      transition: box-shadow 0.3s ease;
    }
    #cityInput:focus {
      box-shadow: 0 0 10px rgba(0, 128, 255, 0.8);
      border: 1px solid #007bff;
    }
  </style>
</head>
<body>

<div class="weather-box text-center">
  <h2 class="mb-4">üå§Ô∏è cloud buddy</h2>
  <div class="input-group mb-3">
    <input type="text" id="cityInput" class="form-control" placeholder="Enter city name" />
    <button onclick="getWeather()" class="btn btn-primary">Search</button>
    <button onclick="getWeatherByLocation()" class="btn btn-success ms-2">Use My Location</button>
  </div>
  <div id="weatherResult" class="mt-4"></div>
  <div id="forecastResult" class="mt-4"></div>
</div>

<script>
  const weatherApiKey = "e7bf4d0714694208bf094245252606"; // Weather API key
  const pexelsApiKey = "3fqXuIrHRvIxXV2i3SEf1T6AmeyqOaOv5wkhNY9zCcHBnpRGl5gUDq3y"; // ‚úÖ Your Pexels API key

  async function getWeather(city) {
    if (!city) {
      city = document.getElementById("cityInput").value.trim();
    }
    const resultBox = document.getElementById("weatherResult");
    const forecastBox = document.getElementById("forecastResult");
    resultBox.classList.remove("show");
    forecastBox.innerHTML = "";
    if (!city) {
      resultBox.innerHTML = `<div class="alert alert-warning">Please enter a city name!</div>`;
      return;
    }
    const weatherUrl = `https://api.weatherapi.com/v1/current.json?key=${weatherApiKey}&q=${city}`;
    const forecastUrl = `https://api.weatherapi.com/v1/forecast.json?key=${weatherApiKey}&q=${city}&days=3`;
    try {
      // Current weather
      const weatherRes = await fetch(weatherUrl);
      const data = await weatherRes.json();
      if (data.error) {
        resultBox.innerHTML = `<div class="alert alert-danger">${data.error.message}</div>`;
        return;
      }
      const weather = data.current;
      const location = data.location;
      const iconUrl = "https:" + weather.condition.icon;
      // üåÜ Load background from Pexels
      const pexelsUrl = `https://api.pexels.com/v1/search?query=${city}&per_page=1`;
      const pexelsRes = await fetch(pexelsUrl, {
        headers: {
          Authorization: pexelsApiKey
        }
      });
      const pexelsData = await pexelsRes.json();
      if (pexelsData.photos && pexelsData.photos.length > 0) {
        const bgUrl = pexelsData.photos[0].src.large2x;
        document.body.style.backgroundImage = `url(${bgUrl})`;
      } else {
        document.body.style.backgroundImage = ""; // fallback if image not found
      }
      // üå§Ô∏è Show weather details
      resultBox.innerHTML = `
        <h4>${location.name}, ${location.country}</h4>
        <img src="${iconUrl}" alt="Weather icon" class="weather-icon"/>
        <p><strong>${weather.condition.text}</strong></p>
        <p>üå°Ô∏è Temperature: <strong>${weather.temp_c}¬∞C</strong></p>
        <p>üíß Humidity: <strong>${weather.humidity}%</strong></p>
        <p>üå¨Ô∏è Wind Speed: <strong>${weather.wind_kph} kph</strong></p>
      `;
      setTimeout(() => resultBox.classList.add("show"), 100);
      // Multi-day forecast
      const forecastRes = await fetch(forecastUrl);
      const forecastData = await forecastRes.json();
      if (forecastData.forecast && forecastData.forecast.forecastday) {
        let forecastHtml = `<h5 class='mt-4'>3-Day Forecast</h5><div class='row'>`;
        forecastData.forecast.forecastday.forEach(day => {
          forecastHtml += `
            <div class='col-12 col-md-4 mb-2'>
              <div class='card'>
                <div class='card-body'>
                  <h6>${day.date}</h6>
                  <img src="https:${day.day.condition.icon}" alt="icon" style="width:40px;"/>
                  <p>${day.day.condition.text}</p>
                  <p>üå°Ô∏è Max: ${day.day.maxtemp_c}¬∞C / Min: ${day.day.mintemp_c}¬∞C</p>
                  <p>üíß Humidity: ${day.day.avghumidity}%</p>
                </div>
              </div>
            </div>
          `;
        });
        forecastHtml += `</div>`;
        forecastBox.innerHTML = forecastHtml;
      }
    } catch (error) {
      resultBox.innerHTML = `<div class="alert alert-danger">Something went wrong. Try again later.</div>`;
      console.error("Error:", error);
    }
  }

  function getWeatherByLocation() {
    if (!navigator.geolocation) {
      alert("Geolocation is not supported by your browser.");
      return;
    }
    navigator.geolocation.getCurrentPosition(
      async (position) => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        const city = `${lat},${lon}`;
        await getWeather(city);
      },
      (error) => {
        alert("Unable to retrieve your location.");
      }
    );
  }
</script>

</body>
</html>
